{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///external \"source-map-support/register\"","webpack:///external \"lodash\"","webpack:///external \"@passportinc/funyan\"","webpack:///./src/constants.js","webpack:///./src/app/index.js","webpack:///external \"@passportinc/serverless-http-stack/middlewares\"","webpack:///./src/database/Todos.js","webpack:///external \"@passportinc/serverless-http-stack/app\"","webpack:///external \"@passportinc/dynomite\"","webpack:///external \"lodash/fp\"","webpack:///external \"@passportinc/serverless-http-stack/utils\"","webpack:///./src/functions/api/index.js","webpack:///(webpack)/buildin/harmony-module.js","webpack:///external \"dotenv\"","webpack:///external \"request-promise\"","webpack:///./src/functions/api/routes/todos.js"],"names":["installedModules","__webpack_require__","moduleId","exports","module","i","l","modules","call","m","c","d","name","getter","o","Object","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","prototype","hasOwnProperty","p","s","require","parse","fp","mapValues","tryJsonParse","assign","_","defaults","process","env","NODE_ENV","AWS_REGION","TODOS_TABLE_NAME","IS_OFFLINE","ALLOWED_ACTION","ALLOWED_STAGE","app","serverlessApp","use","passportStandard","constants","dynomite","table","hashKey","connection","region","indexes","name-index","rangeKey","attributeSchema","id","attributeDefaultValues","config","rp","req","res","ACCESS_TOKEN","create_repo","err","log","info","post","async","func_code_challenges","console","ipdata","JSON","fs","readFileSync","action","payload","application","current_stage","candidate","first_name","last_name","custom_fields","git_hub_user_name","new_repo","replace","user_id","trim","repo","check_repo","method","uri","CURR_ACCOUNT","headers","User-Agent","json","catch","message","body","description","homepage","private","createRepo","status","add_collab","addCollab","originalModule","webpackPolyfill","children","logger","child","withMultiValidation","request","response","params","limit","clamp","toInteger","query","results","Todos","find","exec","debug"],"mappings":"6DACA,IAAAA,EAAA,GAGA,SAAAC,EAAAC,GAGA,GAAAF,EAAAE,GACA,OAAAF,EAAAE,GAAAC,QAGA,IAAAC,EAAAJ,EAAAE,GAAA,CACAG,EAAAH,EACAI,GAAA,EACAH,QAAA,IAUA,OANAI,EAAAL,GAAAM,KAAAJ,EAAAD,QAAAC,IAAAD,QAAAF,GAGAG,EAAAE,GAAA,EAGAF,EAAAD,QA0DA,OArDAF,EAAAQ,EAAAF,EAGAN,EAAAS,EAAAV,EAGAC,EAAAU,EAAA,SAAAR,EAAAS,EAAAC,GACAZ,EAAAa,EAAAX,EAAAS,IACAG,OAAAC,eAAAb,EAAAS,EAAA,CAA0CK,YAAA,EAAAC,IAAAL,KAK1CZ,EAAAkB,EAAA,SAAAhB,GACA,oBAAAiB,eAAAC,aACAN,OAAAC,eAAAb,EAAAiB,OAAAC,YAAA,CAAwDC,MAAA,WAExDP,OAAAC,eAAAb,EAAA,cAAiDmB,OAAA,KAQjDrB,EAAAsB,EAAA,SAAAD,EAAAE,GAEA,GADA,EAAAA,IAAAF,EAAArB,EAAAqB,IACA,EAAAE,EAAA,OAAAF,EACA,KAAAE,GAAA,iBAAAF,QAAAG,WAAA,OAAAH,EACA,IAAAI,EAAAX,OAAAY,OAAA,MAGA,GAFA1B,EAAAkB,EAAAO,GACAX,OAAAC,eAAAU,EAAA,WAAyCT,YAAA,EAAAK,UACzC,EAAAE,GAAA,iBAAAF,EAAA,QAAAM,KAAAN,EAAArB,EAAAU,EAAAe,EAAAE,EAAA,SAAAA,GAAgH,OAAAN,EAAAM,IAAqBC,KAAA,KAAAD,IACrI,OAAAF,GAIAzB,EAAA6B,EAAA,SAAA1B,GACA,IAAAS,EAAAT,KAAAqB,WACA,WAA2B,OAAArB,EAAA,SAC3B,WAAiC,OAAAA,GAEjC,OADAH,EAAAU,EAAAE,EAAA,IAAAA,GACAA,GAIAZ,EAAAa,EAAA,SAAAiB,EAAAC,GAAsD,OAAAjB,OAAAkB,UAAAC,eAAA1B,KAAAuB,EAAAC,IAGtD/B,EAAAkC,EAAA,GAIAlC,IAAAmC,EAAA,oBClFAhC,EAAAD,QAAAkC,QAAA,8CCAAjC,EAAAD,QAAAkC,QAAA,yBCAAjC,EAAAD,QAAAkC,QAAA,sGCeA,MAAMC,EAAQC,IAAGC,UAAUC,gBAMZ1B,WAAO2B,OAAOvC,QAASmC,EAAMK,IAAEC,SAAS,GAAIC,QAAQC,IAAK,CACtEC,SAAUJ,IAAEzB,IAAI2B,QAAS,eAAgB,cACzCG,WAAY,YACZC,iBAAkB,gBAClBC,YAAY,EACZC,eAAgB,yBAChBC,cAAe,mFCfjB,MAAMC,EAAMC,IAAc,OAK1BD,EAAIE,IAAIC,8BAEOH,qBCnBfjD,EAAAD,QAAAkC,QAAA,gHCQA,MAAMW,WACJA,EADIC,iBAEJA,GACEQ,IAEWC,QAAS,CACtBC,MAAOV,EACPW,QAAS,KACTC,WAAY,CACVC,OAAQd,GAEVe,QAAS,CACPC,aAAc,CACZJ,QAAS,OACTK,SAAU,eAGdC,gBAAiB,CACfC,GAAI,gBACJvD,KAAM,8BAERwD,uBAAwB,oBC7B1BhE,EAAAD,QAAAkC,QAAA,yDCAAjC,EAAAD,QAAAkC,QAAA,wCCAAjC,EAAAD,QAAAkC,QAAA,4BCAAjC,EAAAD,QAAAkC,QAAA,uLCUAA,EAAQ,IAAUgC,SAIlB,MAAMC,EAAKjC,EAAQ,IAInBgB,IAAInC,IAAI,mBAAoB,CAACqD,EAAKC,KAGyB3B,QAAQC,IAAI2B,aAOrE,IACEH,EAAGI,aACJ,MAAMC,GACLC,IAAIC,KAAKF,MAIbtB,IAAIyB,KAAK,mBAAoBC,MAAOR,EAAIC,KAwDxCpE,EAAOD,QAAQ6E,qBAAuBD,WACpCE,QAAQL,IAAI,mCAIZ,MAAMM,EAASC,KAAK7C,MAAM8C,GAAGC,aAAa,oBAAoB,SAE9DJ,QAAQL,IAAI,0BAEV,MAAMU,OACJA,EACAC,SACEC,aAAaC,cACXA,EACAC,WAAUC,WACRA,EADQC,UAERA,EACAC,eAAcC,kBACZA,OAKNZ,EAEEa,KAAcJ,EAAWK,QAAQ,MAAO,OAAOJ,EAAUI,QAAQ,MAAO,MACxEC,EAAWH,EAAkBlF,KAAMsF,OACzCjB,QAAQL,IAAImB,EAAUE,GAEtB,IACE,GAAIX,IAAWnF,UAAQgD,gBAAkBsC,EAAc7E,OAAST,UAAQiD,cAAe,CACrF,MAAM+C,OArFOpB,QAAQgB,eACzBnB,IAAIC,KAAK,sBACT,MAAMuB,EAAa,CACfC,OAAQ,MACRC,oCAAqCzD,QAAQC,IAAIyD,gBAAgBR,kBAAyBlD,QAAQC,IAAI2B,eACtG+B,QAAS,CACLC,aAAc,mBAElBC,MAAM,GAUR,GANA9B,IAAIC,KAAK,yCACiBP,EAAG8B,GAC5BO,MAAMhC,IACLM,QAAQL,4BAA4BD,EAAIiC,aAIxC,MAAO,sBAEJ,CACH,MAAMlC,EAAc,CAClB2B,OAAQ,OACRC,sDAAuDzD,QAAQC,IAAI2B,eACnE+B,QAAS,CACLC,aAAc,mBAElBI,KAAM,CACJjG,KAAQmF,EACRe,YAAgB,+CAChBC,SAAY,qBACZC,SAAW,GAEbN,MAAM,GAER,aAAapC,EAAGI,KAiDGuC,CAAW,CAAClB,aAC/B,GAAY,uBAARI,EACF,OAAO3B,EAAI0C,OAAO,KAAKR,KAAK,CAC1BE,QAAST,SA/CD,GAAEJ,WAAUE,cAC5BhB,QAAQL,IAAI,oBACZ,MAAMuC,EAAa,CACjBd,OAAQ,MACRC,oCAAqCzD,QAAQC,IAAIyD,gBAAgBR,mBAA0BE,kBAAwBpD,QAAQC,IAAI2B,eAC/H+B,QAAS,CACLC,aAAc,mBAElBC,MAAM,GAER,OAAOpC,EAAG6C,IAyCcC,CAAU,CAACrB,WAAUE,YACvC,MAAQ,+BAMZ,MAAOtB,GACTM,QAAQL,IAAID,GACZH,EAAI0C,OAAO,KAAK/B,KAAK,CACnByB,QAAQjC,EAAIiC,mDC3IlBxG,EAAAD,QAAA,SAAAkH,GACA,IAAAA,EAAAC,gBAAA,CACA,IAAAlH,EAAAW,OAAAY,OAAA0F,GAEAjH,EAAAmH,WAAAnH,EAAAmH,SAAA,IACAxG,OAAAC,eAAAZ,EAAA,UACAa,YAAA,EACAC,IAAA,WACA,OAAAd,EAAAE,KAGAS,OAAAC,eAAAZ,EAAA,MACAa,YAAA,EACAC,IAAA,WACA,OAAAd,EAAAC,KAGAU,OAAAC,eAAAZ,EAAA,WACAa,YAAA,IAEAb,EAAAkH,gBAAA,EAEA,OAAAlH,kBCtBAA,EAAAD,QAAAkC,QAAA,yBCAAjC,EAAAD,QAAAkC,QAAA,wGCWA,MAAMuC,EAAM4C,IAAOC,MAAM,gBA2BKC,8BAlBvB3C,eAAqC4C,EAASC,GACnD,MAAMhH,KAAEA,GAAS+G,EAAQE,OACnBC,EAAQnF,IAAEoF,MAAMpF,IAAEqF,UAAUL,EAAQM,MAAMH,OAAS,KAAO,EAAG,KAE7DI,QAAgBC,IACnBC,KAAK,CAAExH,QAAQ,cACfkH,MAAMA,GACNO,OAEHzD,EAAI0D,MAAM,yCAA0C1H,EAAMsH,GAC1DN,EAASlB,KAAKwB,IAQyD,CACvEL,OAAQ,CACNjH,KAAM,mBAERqH,MAAO,CACLH,MAAO","file":"src/functions/api/index.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 11);\n","module.exports = require(\"source-map-support/register\");","module.exports = require(\"lodash\");","module.exports = require(\"@passportinc/funyan\");","/**\n * Application wide constants.\n * This exports a shallow clone of process.env with the supplied defaults\n * that will be used if the process.env equivalent is missing. With that said:\n * you *shouldn't* use process.env anywhere in this application, but import from here!\n * @since 5/28/18\n * @file\n */\n\nimport _ from 'lodash';\nimport fp from 'lodash/fp';\nimport { tryJsonParse } from '@passportinc/serverless-http-stack/utils';\n\n// Converts things like ENV_VAR=1 from a string to a number\n// and ENV_VAR=false to a boolean and not the string 'false'.\nconst parse = fp.mapValues(tryJsonParse);\n\n// This will apply environment variables in the following order of precendence:\n// 1. From the CLI (and as defined in the serverless.yml file).\n// 2. From your .env configuration file\n// 3. From the default values missing below.\nexport default Object.assign(exports, parse(_.defaults({}, process.env, {\n  NODE_ENV: _.get(process, 'env.NODE_ENV', 'production'),\n  AWS_REGION: 'us-east-1',\n  TODOS_TABLE_NAME: 'permits-todos',\n  IS_OFFLINE: false,\n  ALLOWED_ACTION: 'candidate_stage_change',\n  ALLOWED_STAGE: 'Code Challenge',\n})));\n","/**\n * Exports the serverless App instance that this application will use.\n * This is used throughout the application by the various routes so that in the event of\n * any service provider change, this can be applied everywhere by editing only this file.\n * Add \"global\" middlewares that apply to every function here.\n * @since 5/28/18\n * @file\n */\n\nimport serverlessApp from '@passportinc/serverless-http-stack/app';\nimport { passportStandard } from '@passportinc/serverless-http-stack/middlewares';\n\nconst app = serverlessApp('aws');\n\n// Sets the middlewares that *every* route will use.\n// You should use \"global\" middlewares sparingly and on an\n// app by app basis since these will apply to all functions!\napp.use(passportStandard());\n\nexport default app;\n","module.exports = require(\"@passportinc/serverless-http-stack/middlewares\");","/**\n * Exports the Todos database model.\n * @file\n */\n\nimport dynomite from '@passportinc/dynomite';\nimport constants from '../constants';\n\nconst {\n  AWS_REGION,\n  TODOS_TABLE_NAME,\n} = constants;\n\nexport default dynomite({\n  table: TODOS_TABLE_NAME,\n  hashKey: 'id',\n  connection: {\n    region: AWS_REGION,\n  },\n  indexes: {\n    'name-index': {\n      hashKey: 'name',\n      rangeKey: 'created_at',\n    },\n  },\n  attributeSchema: {\n    id: 'required|uuid',\n    name: 'required|string|alpha_dash',\n  },\n  attributeDefaultValues: {},\n});\n","module.exports = require(\"@passportinc/serverless-http-stack/app\");","module.exports = require(\"@passportinc/dynomite\");","module.exports = require(\"lodash/fp\");","module.exports = require(\"@passportinc/serverless-http-stack/utils\");","/**\n * The API for the Permits Todo Service.\n * @since 7/24/18\n * @file\n */\n\nimport app from '../../app';\nimport Todos from '../../database/Todos';\nimport { exports } from '../../constants';\nimport log from '@passportinc/funyan';\nrequire('dotenv').config();\n\nimport * as routes from './routes';\n\nconst rp = require('request-promise');\n\n// A custom route to get todos by name.\n\napp.get('/code_challenges', (req, res)=>{\n  const get_repos = {\n    method: 'GET',\n    uri: `https://api.github.com/user/repos?access_token=${process.env.ACCESS_TOKEN}`,\n    headers: {\n        'User-Agent': 'Request-Promise'\n    },\n    json: true,\n  };\n\n  try{\n    rp(create_repo);\n  }catch(err){\n    log.info(err);\n  }\n});\n\napp.post('/code_challenges', async (req,res)=>{\n\n  const createRepo = async ({new_repo}) => {\n    log.info(\"Inside create repo\");\n    const check_repo = {\n        method: 'GET',\n        uri: `https://api.github.com/repos/${process.env.CURR_ACCOUNT}/${new_repo}?access_token=${process.env.ACCESS_TOKEN}`,\n        headers: {\n            'User-Agent': 'Request-Promise'\n        },\n        json: true,\n      };\n\n  //    console.log(\"checking if repo already exists\");\n      log.info(\"checking if repo already exists\");\n      const repo_exists = await rp(check_repo)\n      .catch(err=>{\n        console.log(`No repo by this name ${err.message}`);\n      });\n\n      if (repo_exists){\n        return('Repo already exists');\n      }\n      else {\n        const create_repo = {\n          method: 'POST',\n          uri: `https://api.github.com/user/repos?access_token=${process.env.ACCESS_TOKEN}`,\n          headers: {\n              'User-Agent': 'Request-Promise'\n          },\n          body: {\n            \"name\": new_repo,\n            \"description\": `Making private repo for Code Challenge phase`,\n            \"homepage\": \"https://github.com\",\n            \"private\": true,\n          },\n          json: true,\n        };\n        return await rp(create_repo);\n      };\n\n    };\n\n  const addCollab = ({new_repo, user_id}) => {\n    console.log(\"inside addCollab\");\n    const add_collab = {\n      method: 'PUT',\n      uri: `https://api.github.com/repos/${process.env.CURR_ACCOUNT}/${new_repo}/collaborators/${user_id}?access_token=${process.env.ACCESS_TOKEN}`,\n      headers: {\n          'User-Agent': 'Request-Promise',\n      },\n      json: true,\n    };\n    return rp(add_collab);\n  };\n\nmodule.exports.func_code_challenges = async (event) => {\n  console.log(\"Inside code_challenges function\");\n\n    //Read data from stage_change.json\n    // remember to change this with api call to lambda function.\n  const ipdata = JSON.parse(fs.readFileSync('stage_change.json','utf8'));\n\n  console.log(\"Reading data from file\");\n\n    const {\n      action,\n      payload: {\n        application: {\n          current_stage,\n          candidate:{\n            first_name,\n            last_name,\n            custom_fields:{\n              git_hub_user_name,\n            }\n          },\n        },\n      },\n    } = ipdata;\n\n    const new_repo = `${first_name.replace(/ +/g, \"\")}_${last_name.replace(/ +/g, \"\")}`;\n    const user_id = (git_hub_user_name.name).trim();\n    console.log(new_repo, user_id);\n\n    try {\n      if (action === exports.ALLOWED_ACTION && current_stage.name === exports.ALLOWED_STAGE) {\n        const repo = await createRepo({new_repo});\n        if (repo == 'Repo already exists'){\n          return res.status(400).json({\n            message: repo,\n          });\n        }\n        else{\n          const res = await addCollab({new_repo, user_id});\n          return ('Repo created and user added');\n          return res.status(200).json({\n            message: `'Repo created and ${user_id} added as collaborator'`,\n          });\n          };\n      }\n    } catch (err) {\n    console.log(err);\n    res.status(400).JSON({\n      message:err.message,\n    })\n  };\n\n}\n\n});\n\nexport { app };\n","module.exports = function(originalModule) {\n\tif (!originalModule.webpackPolyfill) {\n\t\tvar module = Object.create(originalModule);\n\t\t// module.parent = undefined by default\n\t\tif (!module.children) module.children = [];\n\t\tObject.defineProperty(module, \"loaded\", {\n\t\t\tenumerable: true,\n\t\t\tget: function() {\n\t\t\t\treturn module.l;\n\t\t\t}\n\t\t});\n\t\tObject.defineProperty(module, \"id\", {\n\t\t\tenumerable: true,\n\t\t\tget: function() {\n\t\t\t\treturn module.i;\n\t\t\t}\n\t\t});\n\t\tObject.defineProperty(module, \"exports\", {\n\t\t\tenumerable: true\n\t\t});\n\t\tmodule.webpackPolyfill = 1;\n\t}\n\treturn module;\n};\n","module.exports = require(\"dotenv\");","module.exports = require(\"request-promise\");","/**\n * Exports custom routes related to todos.\n * @since 3/1/19\n * @file\n */\n\nimport _ from 'lodash';\nimport logger from '@passportinc/funyan';\nimport { withMultiValidation } from '@passportinc/serverless-http-stack/middlewares';\nimport Todos from '../../../database/Todos';\n\nconst log = logger.child('routes:todos');\n\n/**\n * An example route that finds todos by name using the table's `name-index`.\n * @param {Request} request The HTTP Request object.\n * @param {Response} response The HTTP Response object.\n * @returns {undefined}\n * @export\n */\nexport async function getTodosByNameHandler(request, response) {\n  const { name } = request.params;\n  const limit = _.clamp(_.toInteger(request.query.limit || 1000), 1, 1000);\n\n  const results = await Todos\n    .find({ name }, 'name-index')\n    .limit(limit)\n    .exec();\n\n  log.debug('Found the following todos for user %s:', name, results);\n  response.json(results);\n}\n\n// Wraps the `getTodosByNameHandler` checking for the following validations.\n// This will check for a required URL parameter `name` that is a string and\n// an optional query parameter `limit` that must be a number. Also available\n// here is `body` to validate against request body fields.\n// Do your checks here (to keep your handlers squeaky clean).\nexport const getTodosByName = withMultiValidation(getTodosByNameHandler, {\n  params: {\n    name: 'required|string',\n  },\n  query: {\n    limit: 'integer',\n  },\n});\n"],"sourceRoot":""}